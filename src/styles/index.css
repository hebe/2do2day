@tailwind base;
@tailwind components;
@tailwind utilities;

/*
  index.css — calm light/dark theme + subtle category tinting

  Goals (based on your feedback):
  - Light mode: reduce the "grayish" wash in tinted rows (keep it crisp/white)
  - Dark mode: make category differences more visible without becoming loud

  How it works:
  - We define a neutral row surface token: --row-surface
  - Each category defines an accent: --cat-*
  - Category row classes mix surface + accent with different strengths per theme
  - Dark mode also gets a tiny "ink" edge to help scanning in dense lists

  Notes:
  - color-mix(in oklab, …) is supported in modern Chromium/Safari/Firefox.
  - A simple fallback is included for older browsers (it will still look fine).
*/

@layer base {
  :root {
    /* Base surfaces */
    --app-bg: #fdfdfe; /* your light base */
    --row-surface: oklch(0.99 0.002 260); /* cleaner than #fdfdfe => less gray tint */
    --row-hover: oklch(0.975 0.004 260);

    /* Borders / dividers */
    --row-border: oklch(0.90 0.01 260);

    /* Mix strengths — LIGHT */
    --cat-bg-mix: 15%;       /* background tint strength */
    --cat-border-mix: 32%;  /* border tint strength */
    --cat-edge-mix: 65%;    /* (mostly unused in light) */
  }

  /* Tailwind typically toggles dark mode via class on <html> */
  .dark {
    --app-bg: #212936; /* your dark base */
    /* Slightly lighter than #212936 so subtle mixes show up more */
    --row-surface: oklch(0.30 0.03 255);
    --row-hover: oklch(0.34 0.03 255);
    --row-border: oklch(0.42 0.03 255);

    /* Mix strengths — DARK */
    --cat-bg-mix: 18%;
    --cat-border-mix: 40%;
    --cat-edge-mix: 70%;
  }

  /* Optional: if you want the whole page background to match --app-bg */
  body {
    background: var(--app-bg);
  }
}

@layer components {
  /* ---------- Base row look (used by your list rows) ---------- */
  .task-row-base {
    background: var(--row-surface);
    border-color: var(--row-border);
  }

  /* Hover on non-category rows (your JSX uses hover:bg-calm-50 / dark:hover:bg-gray-700) */
  .task-row-base:hover {
    background: var(--row-hover);
  }

  /* ---------- Category rows (dynamic via inline --accent variable) ----------
     Components set --accent inline based on category color
     This allows any user-defined category to work with the OKLab mixing
  */

  /* Preferred implementation (modern browsers): perceptual mix */
  @supports (background: color-mix(in oklab, white, black)) {
    .cat-row {
      /* Background tint */
      background: color-mix(
        in oklab,
        var(--row-surface) calc(100% - var(--cat-bg-mix)),
        var(--accent) var(--cat-bg-mix)
      );

      /* Subtle divider/border tint (works nicely with your row separators) */
      border-color: color-mix(
        in oklab,
        var(--row-surface) calc(100% - var(--cat-border-mix)),
        var(--accent) var(--cat-border-mix)
      );
    }

    /* Hover: a touch stronger tint so it feels interactive */
    .cat-row:hover {
      background: color-mix(
        in oklab,
        var(--row-hover) calc(100% - (var(--cat-bg-mix) + 4%)),
        var(--accent) calc(var(--cat-bg-mix) + 4%)
      );
    }

    /* Dark-mode scan aid: tiny ink edge (keeps background subtle) */
    .dark .cat-row {
      position: relative;
    }

    .dark .cat-row::before {
      content: "";
      position: absolute;
      inset-block: 10px;
      inset-inline-start: 0;
      width: 3px;
      border-radius: 9999px;
      background: color-mix(
        in oklab,
        var(--row-surface) calc(100% - var(--cat-edge-mix)),
        var(--accent) var(--cat-edge-mix)
      );
      opacity: 0.9;
      pointer-events: none;
    }
  }

  /* Fallback for older browsers: still pleasant, just less fancy */
  @supports not (background: color-mix(in oklab, white, black)) {
    .cat-row {
      background: var(--row-surface);
      border-color: var(--row-border);
    }

    /* If you want a fallback hint, uncomment a left border:
    .dark .cat-row {
      border-left: 3px solid rgba(255,255,255,0.08);
    }
    */
  }

  /* Category chip styles for modals (uses same --accent variable) */
  @supports (background: color-mix(in oklab, white, black)) {
    .cat-chip {
      background: color-mix(
        in oklab,
        var(--row-surface) calc(100% - 35%),
        var(--accent) 35%
      );
      color: color-mix(
        in oklab,
        black 70%,
        var(--accent) 30%
      );
    }

    .dark .cat-chip {
      background: color-mix(
        in oklab,
        var(--row-surface) calc(100% - 45%),
        var(--accent) 45%
      );
      color: color-mix(
        in oklab,
        white 85%,
        var(--accent) 15%
      );
    }
  }

  @supports not (background: color-mix(in oklab, white, black)) {
    .cat-chip {
      background: var(--row-surface);
      color: var(--text-primary);
    }
  }
}

/* If you prefer to consume these via Tailwind utilities only,
   you can ignore .task-row-base and just use the cat-row-* classes. */
